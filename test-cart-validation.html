<!DOCTYPE html>
<html lang="es" data-theme="gamer">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Validaciones de Carrito LG-042</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container" style="padding: 2rem; max-width: 1200px; margin: 0 auto;">
        <h1>üß™ Test: LG-042 Reglas M√≠nimas de Carrito</h1>
        
        <!-- Panel de estado del carrito -->
        <div class="cart-status" style="background: #1a1a2e; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <h3>Estado del Carrito</h3>
            <div id="cartStatus">
                <p>Items: <span id="itemCount">0</span></p>
                <p>Subtotal: <span id="subtotalDisplay">$0</span></p>
                <p>Total: <span id="totalDisplay">$0</span></p>
            </div>
        </div>

        <!-- Controles de prueba -->
        <div class="test-controls" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1rem 0;">
            <button onclick="testAddProduct()" class="btn btn-primary">
                ‚ûï Agregar Producto Test
            </button>
            <button onclick="testInvalidQuantity()" class="btn btn-warning">
                ‚ö†Ô∏è Test Cantidad Inv√°lida
            </button>
            <button onclick="testExceedMaxQuantity()" class="btn btn-warning">
                üìä Test Exceder M√°ximo
            </button>
            <button onclick="testMinOrderAmount()" class="btn btn-warning">
                üí∞ Test Monto M√≠nimo
            </button>
            <button onclick="testEmptyCart()" class="btn btn-error">
                üõí Test Carrito Vac√≠o
            </button>
            <button onclick="testMaxCartItems()" class="btn btn-warning">
                üì¶ Test M√°x. Productos
            </button>
            <button onclick="testCheckoutValidation()" class="btn btn-success">
                ‚úÖ Test Checkout Completo
            </button>
            <button onclick="clearCartTest()" class="btn btn-secondary">
                üóëÔ∏è Limpiar Carrito
            </button>
        </div>

        <!-- Container del carrito -->
        <div id="cartContainer" class="cart-container" style="background: #1a1a2e; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <div id="cartItems"></div>
            <div id="cartSummary"></div>
        </div>

        <!-- Log de resultados -->
        <div id="testResults" style="background: #0f0f23; padding: 1rem; border-radius: 8px; margin: 1rem 0; font-family: monospace;">
            <h3>üìã Resultados de Pruebas</h3>
            <div id="logOutput" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/products-database.js"></script>
    <script src="assets/js/cart.js"></script>
    <script src="assets/js/main.js"></script>
    
    <script>
        // Funciones de prueba para LG-042
        let testCounter = 0;
        
        function log(message, type = 'info') {
            const output = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'color: #ff6666' : 
                             type === 'success' ? 'color: #00ff80' : 
                             type === 'warning' ? 'color: #ffaa00' : 'color: #ffffff';
            
            output.innerHTML += `<div style="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function updateCartStatus() {
            document.getElementById('itemCount').textContent = cartState.itemCount;
            document.getElementById('subtotalDisplay').textContent = formatPrice(cartState.subtotal);
            document.getElementById('totalDisplay').textContent = formatPrice(cartState.total);
        }
        
        function testAddProduct() {
            testCounter++;
            log(`üß™ Test ${testCounter}: Agregando producto v√°lido`, 'info');
            
            const testProduct = {
                id: `test-${testCounter}`,
                name: `Producto Test ${testCounter}`,
                price: 25000,
                image: 'assets/images/placeholder.jpg',
                category: 'test',
                stock: 10
            };
            
            const result = addToCart(testProduct, 1);
            log(`Resultado: ${result ? '√âXITO' : 'FALL√ì'}`, result ? 'success' : 'error');
            updateCartStatus();
        }
        
        function testInvalidQuantity() {
            testCounter++;
            log(`üß™ Test ${testCounter}: Cantidad inv√°lida (0)`, 'warning');
            
            const testProduct = {
                id: `test-invalid-${testCounter}`,
                name: 'Producto Cantidad Inv√°lida',
                price: 10000,
                stock: 5
            };
            
            const result = addToCart(testProduct, 0);
            log(`Resultado: ${result ? 'FALL√ì (deber√≠a rechazar)' : '√âXITO (rechazado correctamente)'}`, !result ? 'success' : 'error');
        }
        
        function testExceedMaxQuantity() {
            testCounter++;
            log(`üß™ Test ${testCounter}: Exceder cantidad m√°xima (150)`, 'warning');
            
            const testProduct = {
                id: `test-max-${testCounter}`,
                name: 'Producto Cantidad M√°xima',
                price: 5000,
                stock: 200
            };
            
            const result = addToCart(testProduct, 150);
            log(`Resultado: ${result ? 'FALL√ì (deber√≠a rechazar)' : '√âXITO (rechazado correctamente)'}`, !result ? 'success' : 'error');
        }
        
        function testMinOrderAmount() {
            testCounter++;
            log(`üß™ Test ${testCounter}: Validando monto m√≠nimo`, 'warning');
            
            clearCart();
            
            const smallProduct = {
                id: `test-small-${testCounter}`,
                name: 'Producto Peque√±o',
                price: 1000,
                stock: 10
            };
            
            addToCart(smallProduct, 1);
            const validation = validateCartForCheckout();
            
            log(`Monto: ${formatPrice(cartState.total)}, V√°lido: ${validation.valid}`, validation.valid ? 'error' : 'success');
            if (!validation.valid) {
                log(`Errores: ${validation.errors.join(', ')}`, 'warning');
            }
            updateCartStatus();
        }
        
        function testEmptyCart() {
            testCounter++;
            log(`üß™ Test ${testCounter}: Carrito vac√≠o`, 'warning');
            
            clearCart();
            const validation = validateCartForCheckout();
            
            log(`Carrito vac√≠o, V√°lido: ${validation.valid}`, validation.valid ? 'error' : 'success');
            if (!validation.valid) {
                log(`Errores: ${validation.errors.join(', ')}`, 'warning');
            }
            updateCartStatus();
        }
        
        function testMaxCartItems() {
            testCounter++;
            log(`üß™ Test ${testCounter}: M√°ximo de productos (50)`, 'warning');
            
            clearCart();
            
            // Agregar muchos productos diferentes
            for (let i = 1; i <= 52; i++) {
                const product = {
                    id: `bulk-test-${i}`,
                    name: `Producto Bulk ${i}`,
                    price: 10000,
                    stock: 5
                };
                
                const result = addToCart(product, 1);
                if (!result && i <= 50) {
                    log(`FALL√ì: No pudo agregar producto ${i}`, 'error');
                    break;
                } else if (!result && i > 50) {
                    log(`√âXITO: Rechaz√≥ correctamente producto ${i}`, 'success');
                    break;
                }
            }
            updateCartStatus();
        }
        
        function testCheckoutValidation() {
            testCounter++;
            log(`üß™ Test ${testCounter}: Validaci√≥n completa de checkout`, 'info');
            
            clearCart();
            
            // Agregar productos v√°lidos
            const validProduct = {
                id: `checkout-test-${testCounter}`,
                name: 'Producto Checkout',
                price: 50000,
                stock: 10
            };
            
            addToCart(validProduct, 2);
            
            const validation = validateCartForCheckout();
            log(`Validaci√≥n checkout: ${validation.valid ? '√âXITO' : 'FALL√ì'}`, validation.valid ? 'success' : 'error');
            
            if (!validation.valid) {
                validation.errors.forEach(error => log(`Error: ${error}`, 'warning'));
            }
            
            updateCartStatus();
        }
        
        function clearCartTest() {
            clearCart();
            log('üóëÔ∏è Carrito limpiado', 'info');
            updateCartStatus();
        }
        
        // Inicializar cuando cargue la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Sistema de pruebas LG-042 iniciado', 'success');
            log('Configuraci√≥n del carrito:', 'info');
            log(`- Cantidad m√≠nima: ${CART_CONFIG.minQuantity}`, 'info');
            log(`- Cantidad m√°xima: ${CART_CONFIG.maxQuantity}`, 'info');
            log(`- Monto m√≠nimo: ${formatPrice(CART_CONFIG.validation.minOrderAmount)}`, 'info');
            log(`- M√°x. productos: ${CART_CONFIG.validation.maxCartItems}`, 'info');
            updateCartStatus();
        });
    </script>
</body>
</html>
