<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Test B√∫squeda LEVEL-UP</title>
    <style>
        body { font-family: Arial; padding: 2rem; background: #1a1a2e; color: #eee; }
        .container { max-width: 800px; margin: 0 auto; }
        .search-box { width: 100%; padding: 1rem; font-size: 1.2rem; margin: 1rem 0; }
        .results { background: #16213e; padding: 1rem; border-radius: 8px; margin: 1rem 0; }
        .product { padding: 0.5rem; border-bottom: 1px solid #333; }
        .product:last-child { border-bottom: none; }
        .status { background: #0f3460; padding: 1rem; border-radius: 8px; margin: 1rem 0; }
        .success { background: #0d5f2f; }
        .error { background: #5f0d0d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ LEVEL-UP GAMER - Test B√∫squeda</h1>
        
        <div id="status" class="status">
            <strong>Estado:</strong> <span id="statusText">Inicializando...</span>
        </div>
        
        <div>
            <label for="searchInput"><strong>Buscar productos:</strong></label>
            <input type="text" 
                   id="searchInput" 
                   class="search-box" 
                   placeholder="Escribe al menos 3 letras (ej: play, mouse, zelda)..."
                   autocomplete="off">
        </div>
        
        <div id="results" class="results" style="display: none;">
            <h3>üìã Resultados:</h3>
            <div id="productList"></div>
        </div>
        
        <div class="status">
            <h3>üß™ T√©rminos de prueba sugeridos:</h3>
            <p><strong>Consolas:</strong> "play", "xbox", "nintendo", "switch"</p>
            <p><strong>PC Gaming:</strong> "rtx", "4090", "gaming"</p>
            <p><strong>Accesorios:</strong> "mouse", "teclado", "auricular"</p>
            <p><strong>Juegos:</strong> "mario", "zelda", "spider", "god"</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/products-database.js"></script>
    
    <script>
        console.log('üöÄ Iniciando test de b√∫squeda...');
        
        const statusEl = document.getElementById('statusText');
        const searchInput = document.getElementById('searchInput');
        const resultsEl = document.getElementById('results');
        const productListEl = document.getElementById('productList');
        
        let searchTimeout;
        
        // Funci√≥n para actualizar estado
        function updateStatus(text, type = '') {
            statusEl.textContent = text;
            const statusContainer = document.getElementById('status');
            statusContainer.className = 'status ' + type;
        }
        
        // Funci√≥n para mostrar productos
        function displayProducts(products) {
            if (products.length === 0) {
                productListEl.innerHTML = '<div class="product">‚ùå No se encontraron productos</div>';
            } else {
                productListEl.innerHTML = products.map(product => `
                    <div class="product">
                        <strong>${product.nombre}</strong> - $${product.precio.toLocaleString('es-CL')}
                        <br><small>üìÇ ${product.categoria} | üì¶ Stock: ${product.stock}</small>
                        <br><small>üîñ ${product.tags ? product.tags.join(', ') : 'Sin tags'}</small>
                    </div>
                `).join('');
            }
            resultsEl.style.display = 'block';
        }
        
        // Funci√≥n de b√∫squeda
        function performSearch(query) {
            console.log('üîç Buscando:', query);
            
            if (!window.PRODUCT_DATABASE) {
                updateStatus('‚ùå Base de datos no disponible', 'error');
                return;
            }
            
            if (query.length < 3) {
                resultsEl.style.display = 'none';
                updateStatus('‚úÖ Sistema listo - Escribe al menos 3 caracteres', 'success');
                return;
            }
            
            try {
                const results = window.searchProducts(query);
                console.log('üìä Resultados encontrados:', results.length);
                
                displayProducts(results);
                updateStatus(`‚úÖ Encontrados: ${results.length} productos`, 'success');
                
            } catch (error) {
                console.error('‚ùå Error en b√∫squeda:', error);
                updateStatus('‚ùå Error en la b√∫squeda: ' + error.message, 'error');
            }
        }
        
        // Event listener para el input
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.trim();
            
            // Debounce
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 250);
        });
        
        // Verificar inicializaci√≥n
        function checkInitialization() {
            if (window.PRODUCT_DATABASE) {
                const count = Object.keys(window.PRODUCT_DATABASE).length;
                updateStatus(`‚úÖ Sistema listo - ${count} productos cargados`, 'success');
                
                console.log('‚úÖ Base de datos disponible:', count, 'productos');
                console.log('üìÇ Categor√≠as:', window.getCategories ? window.getCategories() : 'No disponibles');
                
                // Test r√°pido
                const testResults = window.searchProducts('play');
                console.log('üß™ Test b√∫squeda "play":', testResults.length, 'resultados');
                
            } else {
                updateStatus('‚è≥ Cargando base de datos...', '');
                setTimeout(checkInitialization, 100);
            }
        }
        
        // Esperar evento de base de datos
        window.addEventListener('productDatabaseReady', () => {
            console.log('üéØ Evento productDatabaseReady recibido');
            checkInitialization();
        });
        
        // Iniciar verificaci√≥n
        setTimeout(checkInitialization, 100);
    </script>
</body>
</html>