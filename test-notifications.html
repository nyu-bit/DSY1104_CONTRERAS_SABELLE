<!DOCTYPE html>
<html lang="es" data-theme="gamer">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Notificaciones del Carrito LG-043</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container" style="padding: 2rem; max-width: 1200px; margin: 0 auto;">
        <h1>ğŸ”” Test: LG-043 Notificaciones del Carrito</h1>
        
        <!-- InformaciÃ³n sobre accesibilidad -->
        <div class="accessibility-info" style="background: #1a1a2e; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <h3>â™¿ CaracterÃ­sticas de Accesibilidad</h3>
            <ul>
                <li>âœ… Notificaciones con <code>aria-live="polite"</code></li>
                <li>âœ… Mensajes importantes con <code>aria-live="assertive"</code></li>
                <li>âœ… RegiÃ³n aria-live para lectores de pantalla</li>
                <li>âœ… Soporte para modo de alto contraste</li>
                <li>âœ… Respeta preferencias de movimiento reducido</li>
                <li>âœ… DiseÃ±o responsive para mÃ³viles</li>
            </ul>
        </div>

        <!-- Panel de estado del carrito -->
        <div class="cart-status" style="background: #1a1a2e; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <h3>ğŸ›’ Estado del Carrito</h3>
            <div id="cartStatus">
                <p>Items: <span id="itemCount">0</span></p>
                <p>Subtotal: <span id="subtotalDisplay">$0</span></p>
                <p>Total: <span id="totalDisplay">$0</span></p>
            </div>
        </div>

        <!-- Controles de prueba para notificaciones -->
        <div class="test-controls" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1rem 0;">
            <button onclick="testAddProductNotification()" class="btn btn-success">
                â• Test: Producto Agregado
            </button>
            <button onclick="testRemoveProductNotification()" class="btn btn-warning">
                ğŸ—‘ï¸ Test: Producto Eliminado
            </button>
            <button onclick="testQuantityUpdateNotification()" class="btn btn-info">
                ğŸ“Š Test: Cantidad Actualizada
            </button>
            <button onclick="testClearCartNotification()" class="btn btn-secondary">
                ğŸ—‘ï¸ Test: Carrito Vaciado
            </button>
            <button onclick="testSuccessNotification()" class="btn btn-success">
                ğŸ‰ Test: Compra Exitosa
            </button>
            <button onclick="testErrorNotification()" class="btn btn-error">
                âŒ Test: Error
            </button>
            <button onclick="testWarningNotification()" class="btn btn-warning">
                âš ï¸ Test: Advertencia
            </button>
            <button onclick="testInfoNotification()" class="btn btn-primary">
                â„¹ï¸ Test: InformaciÃ³n
            </button>
        </div>

        <!-- Pruebas de accesibilidad -->
        <div class="accessibility-tests" style="background: #0f0f23; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <h3>â™¿ Pruebas de Accesibilidad</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <button onclick="testAriaLivePolite()" class="btn btn-info">
                    ğŸ”Š aria-live="polite"
                </button>
                <button onclick="testAriaLiveAssertive()" class="btn btn-warning">
                    ğŸ”Š aria-live="assertive"
                </button>
                <button onclick="testLongMessage()" class="btn btn-secondary">
                    ğŸ“ Mensaje Largo
                </button>
                <button onclick="testMultipleNotifications()" class="btn btn-primary">
                    ğŸ“± MÃºltiples Notificaciones
                </button>
            </div>
        </div>

        <!-- Log de actividad -->
        <div id="activityLog" style="background: #0f0f23; padding: 1rem; border-radius: 8px; margin: 1rem 0; font-family: monospace;">
            <h3>ğŸ“‹ Log de Actividad</h3>
            <div id="logOutput" style="max-height: 300px; overflow-y: auto;"></div>
        </div>

        <!-- Instrucciones para lectores de pantalla -->
        <div class="sr-only" aria-live="polite" id="screenReaderInstructions">
            Esta pÃ¡gina estÃ¡ probando las notificaciones del carrito de compras. Use los botones para generar diferentes tipos de notificaciones y observe cÃ³mo se anuncian.
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/products-database.js"></script>
    <script src="assets/js/cart.js"></script>
    <script src="assets/js/main.js"></script>
    
    <script>
        // Variables para las pruebas
        let testCounter = 0;
        let testProducts = [];
        
        // Productos de prueba
        const sampleProducts = [
            {
                id: 'test-headset',
                name: 'Auriculares Gaming RGB',
                price: 45000,
                image: 'assets/images/placeholder.jpg',
                category: 'accesorios',
                stock: 15
            },
            {
                id: 'test-mouse',
                name: 'Mouse Gaming InalÃ¡mbrico',
                price: 25000,
                image: 'assets/images/placeholder.jpg',
                category: 'accesorios',
                stock: 8
            },
            {
                id: 'test-keyboard',
                name: 'Teclado MecÃ¡nico RGB',
                price: 65000,
                image: 'assets/images/placeholder.jpg',
                category: 'accesorios',
                stock: 12
            }
        ];
        
        function log(message, type = 'info') {
            const output = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'color: #ff6666' : 
                             type === 'success' ? 'color: #00ff80' : 
                             type === 'warning' ? 'color: #ffaa00' : 'color: #ffffff';
            
            output.innerHTML += `<div style="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function updateCartStatus() {
            if (typeof cartState !== 'undefined') {
                document.getElementById('itemCount').textContent = cartState.itemCount || 0;
                document.getElementById('subtotalDisplay').textContent = typeof formatPrice === 'function' ? formatPrice(cartState.subtotal || 0) : '$0';
                document.getElementById('totalDisplay').textContent = typeof formatPrice === 'function' ? formatPrice(cartState.total || 0) : '$0';
            }
        }
        
        // Funciones de prueba para notificaciones
        function testAddProductNotification() {
            testCounter++;
            const product = sampleProducts[testCounter % sampleProducts.length];
            const quantity = Math.floor(Math.random() * 3) + 1;
            
            log(`ğŸ§ª Test ${testCounter}: NotificaciÃ³n de producto agregado`, 'info');
            
            if (typeof cartNotifications !== 'undefined' && cartNotifications.notifyProductAdded) {
                cartNotifications.notifyProductAdded(product, quantity);
                log(`âœ… NotificaciÃ³n enviada: ${product.name} (${quantity} unidades)`, 'success');
            } else {
                // Fallback usando showCartNotification directamente
                if (typeof showCartNotification === 'function') {
                    showCartNotification(`ğŸ›’ ${product.name} agregado al carrito (${quantity} unidades)`, 'success');
                    log(`âœ… NotificaciÃ³n fallback enviada`, 'success');
                } else {
                    log(`âŒ Sistema de notificaciones no disponible`, 'error');
                }
            }
            
            updateCartStatus();
        }
        
        function testRemoveProductNotification() {
            testCounter++;
            const product = sampleProducts[testCounter % sampleProducts.length];
            
            log(`ğŸ§ª Test ${testCounter}: NotificaciÃ³n de producto eliminado`, 'info');
            
            if (typeof cartNotifications !== 'undefined' && cartNotifications.notifyProductRemoved) {
                cartNotifications.notifyProductRemoved(product);
                log(`âœ… NotificaciÃ³n enviada: ${product.name} eliminado`, 'success');
            } else {
                showCartNotification(`ğŸ—‘ï¸ ${product.name} eliminado del carrito`, 'info');
                log(`âœ… NotificaciÃ³n fallback enviada`, 'success');
            }
        }
        
        function testQuantityUpdateNotification() {
            testCounter++;
            const product = sampleProducts[testCounter % sampleProducts.length];
            const oldQuantity = Math.floor(Math.random() * 3) + 1;
            const newQuantity = Math.floor(Math.random() * 5) + 1;
            
            log(`ğŸ§ª Test ${testCounter}: NotificaciÃ³n de cantidad actualizada`, 'info');
            
            if (typeof cartNotifications !== 'undefined' && cartNotifications.notifyQuantityUpdated) {
                cartNotifications.notifyQuantityUpdated(product, oldQuantity, newQuantity);
                log(`âœ… NotificaciÃ³n enviada: ${product.name} ${oldQuantity} â†’ ${newQuantity}`, 'success');
            } else {
                const action = newQuantity > oldQuantity ? 'aumentada' : 'reducida';
                showCartNotification(`ğŸ“Š Cantidad ${action}: ${product.name} (${newQuantity} unidades)`, 'info');
                log(`âœ… NotificaciÃ³n fallback enviada`, 'success');
            }
        }
        
        function testClearCartNotification() {
            testCounter++;
            log(`ğŸ§ª Test ${testCounter}: NotificaciÃ³n de carrito vaciado`, 'info');
            
            if (typeof cartNotifications !== 'undefined' && cartNotifications.notifyCartCleared) {
                cartNotifications.notifyCartCleared();
                log(`âœ… NotificaciÃ³n enviada: Carrito vaciado`, 'success');
            } else {
                showCartNotification('ğŸ—‘ï¸ Carrito vaciado completamente', 'info');
                log(`âœ… NotificaciÃ³n fallback enviada`, 'success');
            }
        }
        
        function testSuccessNotification() {
            testCounter++;
            const total = 156000;
            const itemCount = 3;
            
            log(`ğŸ§ª Test ${testCounter}: NotificaciÃ³n de compra exitosa`, 'info');
            
            if (typeof cartNotifications !== 'undefined' && cartNotifications.notifyPurchaseSuccess) {
                cartNotifications.notifyPurchaseSuccess(total, itemCount);
                log(`âœ… NotificaciÃ³n enviada: Compra exitosa $${total}`, 'success');
            } else {
                showCartNotification(`ğŸ‰ Â¡Compra exitosa! ${itemCount} productos por $${total}`, 'success');
                log(`âœ… NotificaciÃ³n fallback enviada`, 'success');
            }
        }
        
        function testErrorNotification() {
            testCounter++;
            log(`ğŸ§ª Test ${testCounter}: NotificaciÃ³n de error`, 'error');
            
            showCartNotification('âŒ Error: No se pudo procesar el pago. Verifique sus datos.', 'error');
            log(`âœ… NotificaciÃ³n de error enviada`, 'error');
        }
        
        function testWarningNotification() {
            testCounter++;
            log(`ğŸ§ª Test ${testCounter}: NotificaciÃ³n de advertencia`, 'warning');
            
            showCartNotification('âš ï¸ Advertencia: Quedan solo 2 unidades en stock', 'warning');
            log(`âœ… NotificaciÃ³n de advertencia enviada`, 'warning');
        }
        
        function testInfoNotification() {
            testCounter++;
            log(`ğŸ§ª Test ${testCounter}: NotificaciÃ³n informativa`, 'info');
            
            showCartNotification('â„¹ï¸ InformaciÃ³n: EnvÃ­o gratis disponible para compras sobre $50.000', 'info');
            log(`âœ… NotificaciÃ³n informativa enviada`, 'info');
        }
        
        // Pruebas especÃ­ficas de accesibilidad
        function testAriaLivePolite() {
            testCounter++;
            log(`ğŸ§ª Test ${testCounter}: aria-live="polite"`, 'info');
            
            showCartNotification('ğŸ”Š Esta notificaciÃ³n usa aria-live="polite" - se anuncia cuando el lector de pantalla termina de leer', 'info', {
                ariaLevel: 'polite'
            });
            log(`âœ… NotificaciÃ³n polite enviada`, 'info');
        }
        
        function testAriaLiveAssertive() {
            testCounter++;
            log(`ğŸ§ª Test ${testCounter}: aria-live="assertive"`, 'warning');
            
            showCartNotification('ğŸ”Š Esta notificaciÃ³n usa aria-live="assertive" - interrumpe al lector de pantalla', 'warning', {
                ariaLevel: 'assertive'
            });
            log(`âœ… NotificaciÃ³n assertive enviada`, 'warning');
        }
        
        function testLongMessage() {
            testCounter++;
            log(`ğŸ§ª Test ${testCounter}: Mensaje largo`, 'info');
            
            showCartNotification('ğŸ“ Esta es una notificaciÃ³n con un mensaje muy largo para probar cÃ³mo se comporta el sistema con textos extensos. El mensaje debe ser legible y accesible incluso cuando contiene mucha informaciÃ³n importante para el usuario.', 'info', {
                duration: 6000
            });
            log(`âœ… NotificaciÃ³n de mensaje largo enviada`, 'info');
        }
        
        function testMultipleNotifications() {
            testCounter++;
            log(`ğŸ§ª Test ${testCounter}: MÃºltiples notificaciones`, 'info');
            
            // Enviar varias notificaciones rÃ¡pidamente
            setTimeout(() => showCartNotification('1ï¸âƒ£ Primera notificaciÃ³n', 'info'), 0);
            setTimeout(() => showCartNotification('2ï¸âƒ£ Segunda notificaciÃ³n', 'success'), 500);
            setTimeout(() => showCartNotification('3ï¸âƒ£ Tercera notificaciÃ³n', 'warning'), 1000);
            setTimeout(() => showCartNotification('4ï¸âƒ£ Cuarta notificaciÃ³n', 'error'), 1500);
            
            log(`âœ… Serie de notificaciones enviada`, 'info');
        }
        
        // Inicializar cuando cargue la pÃ¡gina
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ Sistema de pruebas LG-043 iniciado', 'success');
            log('Verificando disponibilidad de funciones:', 'info');
            log(`- showCartNotification: ${typeof showCartNotification === 'function' ? 'DISPONIBLE' : 'NO DISPONIBLE'}`, 'info');
            log(`- cartNotifications: ${typeof cartNotifications !== 'undefined' ? 'DISPONIBLE' : 'NO DISPONIBLE'}`, 'info');
            log(`- formatPrice: ${typeof formatPrice === 'function' ? 'DISPONIBLE' : 'NO DISPONIBLE'}`, 'info');
            
            updateCartStatus();
            
            // Mostrar notificaciÃ³n de bienvenida
            setTimeout(() => {
                showCartNotification('ğŸ¯ Sistema de notificaciones LG-043 listo para pruebas', 'success', {
                    duration: 4000
                });
            }, 1000);
        });
    </script>
</body>
</html>
