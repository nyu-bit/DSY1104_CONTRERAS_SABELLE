<!DOCTYPE html>
<html lang="es" data-theme="gamer">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Notificaciones del Carrito LG-043</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container" style="padding: 2rem; max-width: 1200px; margin: 0 auto;">
        <h1>🔔 Test: LG-043 Notificaciones del Carrito</h1>
        
        <!-- Información sobre accesibilidad -->
        <div class="accessibility-info" style="background: #1a1a2e; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <h3>♿ Características de Accesibilidad</h3>
            <ul>
                <li>✅ Notificaciones con <code>aria-live="polite"</code></li>
                <li>✅ Mensajes importantes con <code>aria-live="assertive"</code></li>
                <li>✅ Región aria-live para lectores de pantalla</li>
                <li>✅ Soporte para modo de alto contraste</li>
                <li>✅ Respeta preferencias de movimiento reducido</li>
                <li>✅ Diseño responsive para móviles</li>
            </ul>
        </div>

        <!-- Panel de estado del carrito -->
        <div class="cart-status" style="background: #1a1a2e; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <h3>🛒 Estado del Carrito</h3>
            <div id="cartStatus">
                <p>Items: <span id="itemCount">0</span></p>
                <p>Subtotal: <span id="subtotalDisplay">$0</span></p>
                <p>Total: <span id="totalDisplay">$0</span></p>
            </div>
        </div>

        <!-- Controles de prueba para notificaciones -->
        <div class="test-controls" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1rem 0;">
            <button onclick="testAddProductNotification()" class="btn btn-success">
                ➕ Test: Producto Agregado
            </button>
            <button onclick="testRemoveProductNotification()" class="btn btn-warning">
                🗑️ Test: Producto Eliminado
            </button>
            <button onclick="testQuantityUpdateNotification()" class="btn btn-info">
                📊 Test: Cantidad Actualizada
            </button>
            <button onclick="testClearCartNotification()" class="btn btn-secondary">
                🗑️ Test: Carrito Vaciado
            </button>
            <button onclick="testSuccessNotification()" class="btn btn-success">
                🎉 Test: Compra Exitosa
            </button>
            <button onclick="testErrorNotification()" class="btn btn-error">
                ❌ Test: Error
            </button>
            <button onclick="testWarningNotification()" class="btn btn-warning">
                ⚠️ Test: Advertencia
            </button>
            <button onclick="testInfoNotification()" class="btn btn-primary">
                ℹ️ Test: Información
            </button>
        </div>

        <!-- Pruebas de accesibilidad -->
        <div class="accessibility-tests" style="background: #0f0f23; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <h3>♿ Pruebas de Accesibilidad</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <button onclick="testAriaLivePolite()" class="btn btn-info">
                    🔊 aria-live="polite"
                </button>
                <button onclick="testAriaLiveAssertive()" class="btn btn-warning">
                    🔊 aria-live="assertive"
                </button>
                <button onclick="testLongMessage()" class="btn btn-secondary">
                    📝 Mensaje Largo
                </button>
                <button onclick="testMultipleNotifications()" class="btn btn-primary">
                    📱 Múltiples Notificaciones
                </button>
            </div>
        </div>

        <!-- Log de actividad -->
        <div id="activityLog" style="background: #0f0f23; padding: 1rem; border-radius: 8px; margin: 1rem 0; font-family: monospace;">
            <h3>📋 Log de Actividad</h3>
            <div id="logOutput" style="max-height: 300px; overflow-y: auto;"></div>
        </div>

        <!-- Instrucciones para lectores de pantalla -->
        <div class="sr-only" aria-live="polite" id="screenReaderInstructions">
            Esta página está probando las notificaciones del carrito de compras. Use los botones para generar diferentes tipos de notificaciones y observe cómo se anuncian.
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/products-database.js"></script>
    <script src="assets/js/cart.js"></script>
    <script src="assets/js/main.js"></script>
    
    <script>
        // Variables para las pruebas
        let testCounter = 0;
        let testProducts = [];
        
        // Productos de prueba
        const sampleProducts = [
            {
                id: 'test-headset',
                name: 'Auriculares Gaming RGB',
                price: 45000,
                image: 'assets/images/placeholder.jpg',
                category: 'accesorios',
                stock: 15
            },
            {
                id: 'test-mouse',
                name: 'Mouse Gaming Inalámbrico',
                price: 25000,
                image: 'assets/images/placeholder.jpg',
                category: 'accesorios',
                stock: 8
            },
            {
                id: 'test-keyboard',
                name: 'Teclado Mecánico RGB',
                price: 65000,
                image: 'assets/images/placeholder.jpg',
                category: 'accesorios',
                stock: 12
            }
        ];
        
        function log(message, type = 'info') {
            const output = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'color: #ff6666' : 
                             type === 'success' ? 'color: #00ff80' : 
                             type === 'warning' ? 'color: #ffaa00' : 'color: #ffffff';
            
            output.innerHTML += `<div style="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function updateCartStatus() {
            if (typeof cartState !== 'undefined') {
                document.getElementById('itemCount').textContent = cartState.itemCount || 0;
                document.getElementById('subtotalDisplay').textContent = typeof formatPrice === 'function' ? formatPrice(cartState.subtotal || 0) : '$0';
                document.getElementById('totalDisplay').textContent = typeof formatPrice === 'function' ? formatPrice(cartState.total || 0) : '$0';
            }
        }
        
        // Funciones de prueba para notificaciones
        function testAddProductNotification() {
            testCounter++;
            const product = sampleProducts[testCounter % sampleProducts.length];
            const quantity = Math.floor(Math.random() * 3) + 1;
            
            log(`🧪 Test ${testCounter}: Notificación de producto agregado`, 'info');
            
            if (typeof cartNotifications !== 'undefined' && cartNotifications.notifyProductAdded) {
                cartNotifications.notifyProductAdded(product, quantity);
                log(`✅ Notificación enviada: ${product.name} (${quantity} unidades)`, 'success');
            } else {
                // Fallback usando showCartNotification directamente
                if (typeof showCartNotification === 'function') {
                    showCartNotification(`🛒 ${product.name} agregado al carrito (${quantity} unidades)`, 'success');
                    log(`✅ Notificación fallback enviada`, 'success');
                } else {
                    log(`❌ Sistema de notificaciones no disponible`, 'error');
                }
            }
            
            updateCartStatus();
        }
        
        function testRemoveProductNotification() {
            testCounter++;
            const product = sampleProducts[testCounter % sampleProducts.length];
            
            log(`🧪 Test ${testCounter}: Notificación de producto eliminado`, 'info');
            
            if (typeof cartNotifications !== 'undefined' && cartNotifications.notifyProductRemoved) {
                cartNotifications.notifyProductRemoved(product);
                log(`✅ Notificación enviada: ${product.name} eliminado`, 'success');
            } else {
                showCartNotification(`🗑️ ${product.name} eliminado del carrito`, 'info');
                log(`✅ Notificación fallback enviada`, 'success');
            }
        }
        
        function testQuantityUpdateNotification() {
            testCounter++;
            const product = sampleProducts[testCounter % sampleProducts.length];
            const oldQuantity = Math.floor(Math.random() * 3) + 1;
            const newQuantity = Math.floor(Math.random() * 5) + 1;
            
            log(`🧪 Test ${testCounter}: Notificación de cantidad actualizada`, 'info');
            
            if (typeof cartNotifications !== 'undefined' && cartNotifications.notifyQuantityUpdated) {
                cartNotifications.notifyQuantityUpdated(product, oldQuantity, newQuantity);
                log(`✅ Notificación enviada: ${product.name} ${oldQuantity} → ${newQuantity}`, 'success');
            } else {
                const action = newQuantity > oldQuantity ? 'aumentada' : 'reducida';
                showCartNotification(`📊 Cantidad ${action}: ${product.name} (${newQuantity} unidades)`, 'info');
                log(`✅ Notificación fallback enviada`, 'success');
            }
        }
        
        function testClearCartNotification() {
            testCounter++;
            log(`🧪 Test ${testCounter}: Notificación de carrito vaciado`, 'info');
            
            if (typeof cartNotifications !== 'undefined' && cartNotifications.notifyCartCleared) {
                cartNotifications.notifyCartCleared();
                log(`✅ Notificación enviada: Carrito vaciado`, 'success');
            } else {
                showCartNotification('🗑️ Carrito vaciado completamente', 'info');
                log(`✅ Notificación fallback enviada`, 'success');
            }
        }
        
        function testSuccessNotification() {
            testCounter++;
            const total = 156000;
            const itemCount = 3;
            
            log(`🧪 Test ${testCounter}: Notificación de compra exitosa`, 'info');
            
            if (typeof cartNotifications !== 'undefined' && cartNotifications.notifyPurchaseSuccess) {
                cartNotifications.notifyPurchaseSuccess(total, itemCount);
                log(`✅ Notificación enviada: Compra exitosa $${total}`, 'success');
            } else {
                showCartNotification(`🎉 ¡Compra exitosa! ${itemCount} productos por $${total}`, 'success');
                log(`✅ Notificación fallback enviada`, 'success');
            }
        }
        
        function testErrorNotification() {
            testCounter++;
            log(`🧪 Test ${testCounter}: Notificación de error`, 'error');
            
            showCartNotification('❌ Error: No se pudo procesar el pago. Verifique sus datos.', 'error');
            log(`✅ Notificación de error enviada`, 'error');
        }
        
        function testWarningNotification() {
            testCounter++;
            log(`🧪 Test ${testCounter}: Notificación de advertencia`, 'warning');
            
            showCartNotification('⚠️ Advertencia: Quedan solo 2 unidades en stock', 'warning');
            log(`✅ Notificación de advertencia enviada`, 'warning');
        }
        
        function testInfoNotification() {
            testCounter++;
            log(`🧪 Test ${testCounter}: Notificación informativa`, 'info');
            
            showCartNotification('ℹ️ Información: Envío gratis disponible para compras sobre $50.000', 'info');
            log(`✅ Notificación informativa enviada`, 'info');
        }
        
        // Pruebas específicas de accesibilidad
        function testAriaLivePolite() {
            testCounter++;
            log(`🧪 Test ${testCounter}: aria-live="polite"`, 'info');
            
            showCartNotification('🔊 Esta notificación usa aria-live="polite" - se anuncia cuando el lector de pantalla termina de leer', 'info', {
                ariaLevel: 'polite'
            });
            log(`✅ Notificación polite enviada`, 'info');
        }
        
        function testAriaLiveAssertive() {
            testCounter++;
            log(`🧪 Test ${testCounter}: aria-live="assertive"`, 'warning');
            
            showCartNotification('🔊 Esta notificación usa aria-live="assertive" - interrumpe al lector de pantalla', 'warning', {
                ariaLevel: 'assertive'
            });
            log(`✅ Notificación assertive enviada`, 'warning');
        }
        
        function testLongMessage() {
            testCounter++;
            log(`🧪 Test ${testCounter}: Mensaje largo`, 'info');
            
            showCartNotification('📝 Esta es una notificación con un mensaje muy largo para probar cómo se comporta el sistema con textos extensos. El mensaje debe ser legible y accesible incluso cuando contiene mucha información importante para el usuario.', 'info', {
                duration: 6000
            });
            log(`✅ Notificación de mensaje largo enviada`, 'info');
        }
        
        function testMultipleNotifications() {
            testCounter++;
            log(`🧪 Test ${testCounter}: Múltiples notificaciones`, 'info');
            
            // Enviar varias notificaciones rápidamente
            setTimeout(() => showCartNotification('1️⃣ Primera notificación', 'info'), 0);
            setTimeout(() => showCartNotification('2️⃣ Segunda notificación', 'success'), 500);
            setTimeout(() => showCartNotification('3️⃣ Tercera notificación', 'warning'), 1000);
            setTimeout(() => showCartNotification('4️⃣ Cuarta notificación', 'error'), 1500);
            
            log(`✅ Serie de notificaciones enviada`, 'info');
        }
        
        // Inicializar cuando cargue la página
        document.addEventListener('DOMContentLoaded', function() {
            log('🚀 Sistema de pruebas LG-043 iniciado', 'success');
            log('Verificando disponibilidad de funciones:', 'info');
            log(`- showCartNotification: ${typeof showCartNotification === 'function' ? 'DISPONIBLE' : 'NO DISPONIBLE'}`, 'info');
            log(`- cartNotifications: ${typeof cartNotifications !== 'undefined' ? 'DISPONIBLE' : 'NO DISPONIBLE'}`, 'info');
            log(`- formatPrice: ${typeof formatPrice === 'function' ? 'DISPONIBLE' : 'NO DISPONIBLE'}`, 'info');
            
            updateCartStatus();
            
            // Mostrar notificación de bienvenida
            setTimeout(() => {
                showCartNotification('🎯 Sistema de notificaciones LG-043 listo para pruebas', 'success', {
                    duration: 4000
                });
            }, 1000);
        });
    </script>
</body>
</html>
