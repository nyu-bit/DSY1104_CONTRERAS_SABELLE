// Base de datos de productos LevelUp Gaming
// Integrado con localStorage según requerimientos del profesor

// Datos base de productos (estructura PRODUCTS_LG)
var PRODUCTS_LG_DATA = [
  {
    code: "JM001",
    nombre: "Catan - Juego de Mesa Estratégico",
    categoriaId: "JM",
    precioCLP: 29990,
    stock: 25,
    marca: "Kosmos",
    rating: 4.8,
    specs: ["3-4 jugadores", "60-90 min", "Estrategia"],
    descripcion: "Clásico juego de estrategia de colonización y comercio.",
    tags: ["familiar", "estrategia", "clasico"],
    imagen: "assets/products/jm001.jpg"
  },
  {
    code: "AC001",
    nombre: "Auriculares Gaming HyperX Cloud II",
    categoriaId: "AC",
    precioCLP: 89990,
    stock: 15,
    marca: "HyperX",
    rating: 4.7,
    specs: ["7.1 Surround", "Micrófono desmontable", "USB/3.5mm"],
    descripcion: "Auriculares gaming profesionales con sonido envolvente.",
    tags: ["audio", "gaming", "profesional"],
    imagen: "assets/products/ac001.jpg"
  },
  {
    code: "CO001",
    nombre: "PlayStation 5 Standard",
    categoriaId: "CO",
    precioCLP: 599990,
    stock: 8,
    marca: "Sony",
    rating: 4.9,
    specs: ["SSD 825GB", "Ray Tracing", "4K/120fps"],
    descripcion: "Consola de nueva generación con SSD ultra rápido.",
    tags: ["consola", "next-gen", "4k"],
    imagen: "assets/products/co001.jpg"
  },
  {
    code: "CG001",
    nombre: "PC Gamer RTX 4060",
    categoriaId: "CG",
    precioCLP: 899990,
    stock: 12,
    marca: "LevelUp Custom",
    rating: 4.6,
    specs: ["RTX 4060 8GB", "Ryzen 5 7600X", "16GB DDR5"],
    descripcion: "PC gaming completo optimizado para 1440p.",
    tags: ["pc", "gaming", "rtx"],
    imagen: "assets/products/cg001.jpg"
  },
  {
    code: "SG001",
    nombre: "Silla Gaming DXRacer Formula",
    categoriaId: "SG",
    precioCLP: 299990,
    stock: 20,
    marca: "DXRacer",
    rating: 4.5,
    specs: ["Cuero PU", "Soporte lumbar", "Reposabrazos 4D"],
    descripcion: "Silla gaming ergonómica inspirada en asientos de carreras.",
    tags: ["silla", "ergonomica", "racing"],
    imagen: "assets/products/sg001.jpg"
  },
  {
    code: "MS001",
    nombre: "Mouse Gaming Logitech G502",
    categoriaId: "MS",
    precioCLP: 79990,
    stock: 30,
    marca: "Logitech",
    rating: 4.8,
    specs: ["25,600 DPI", "11 botones", "RGB Lightsync"],
    descripcion: "Mouse gaming de alta precisión con sensor HERO.",
    tags: ["mouse", "precision", "rgb"],
    imagen: "assets/products/ms001.jpg"
  },
  {
    code: "MP001",
    nombre: "Mousepad Gaming SteelSeries QcK XXL",
    categoriaId: "MP",
    precioCLP: 39990,
    stock: 45,
    marca: "SteelSeries",
    rating: 4.7,
    specs: ["900x400mm", "Base antideslizante", "Surface micro-tejida"],
    descripcion: "Mousepad gaming XXL con superficie optimizada.",
    tags: ["mousepad", "xxl", "precision"],
    imagen: "assets/products/mp001.jpg"
  },
  {
    code: "PP001",
    nombre: "Polera Gaming LevelUp Retro",
    categoriaId: "PP",
    precioCLP: 19990,
    stock: 50,
    marca: "LevelUp",
    rating: 4.4,
    specs: ["100% Algodón", "Estampado HD", "Tallas S-XXL"],
    descripcion: "Polera gamer con diseño retro exclusivo.",
    tags: ["polera", "retro", "gaming"],
    imagen: "assets/products/pp001.jpg"
  },
  {
    code: "PN001",
    nombre: "Polerón Gaming LevelUp Pro",
    categoriaId: "PN",
    precioCLP: 34990,
    stock: 35,
    marca: "LevelUp",
    rating: 4.6,
    specs: ["Poliéster-Algodón", "Capucha ajustable", "Bolsillo canguro"],
    descripcion: "Polerón gaming con capucha y diseño exclusivo.",
    tags: ["poleron", "capucha", "gaming"],
    imagen: "assets/products/pn001.jpg"
  },
  {
    code: "ST001",
    nombre: "Servicio Técnico Gaming",
    categoriaId: "ST",
    precioCLP: 15990,
    stock: 100,
    marca: "LevelUp Tech",
    rating: 4.9,
    specs: ["Diagnóstico completo", "Limpieza interna", "Optimización"],
    descripcion: "Servicio técnico especializado para equipos gaming.",
    tags: ["servicio", "tecnico", "gaming"],
    imagen: "assets/products/st001.jpg"
  }
];

// Función para cargar desde localStorage o usar datos base
function loadProductsFromStorage() {
  try {
    if (typeof localStorage !== 'undefined') {
      var stored = localStorage.getItem('levelup_products');
      if (stored) {
        return JSON.parse(stored);
      }
    }
  } catch (error) {
    console.warn('Error cargando desde localStorage:', error);
  }
  return PRODUCTS_LG_DATA;
}

// Cargar productos
var PRODUCTS_LG = loadProductsFromStorage();

// Hacer variables globales para el navegador
if (typeof window !== 'undefined') {
  window.PRODUCTS_LG = PRODUCTS_LG;
}

// Declarar PRODUCT_DATABASE globalmente
var PRODUCT_DATABASE = {};

// Crear objeto PRODUCT_DATABASE para compatibilidad
for (var i = 0; i < PRODUCTS_LG.length; i++) {
  var product = PRODUCTS_LG[i];
  PRODUCT_DATABASE[product.code] = {
    id: product.code,
    name: product.nombre,
    price: product.precioCLP,
    category: product.categoriaId.toLowerCase(),
    brand: product.marca,
    rating: product.rating,
    image: product.imagen,
    inStock: product.stock > 0,
    stock: product.stock,
    description: product.descripcion,
    specs: product.specs,
    tags: product.tags
  };
}

// Hacer PRODUCT_DATABASE global también
if (typeof window !== 'undefined') {
  window.PRODUCT_DATABASE = PRODUCT_DATABASE;
}

// Funciones de acceso
function getAllProducts() {
  return PRODUCTS_LG;
}

function getProductById(id) {
  return PRODUCT_DATABASE[id] || null;
}

function getProductByCode(code) {
  for (var i = 0; i < PRODUCTS_LG.length; i++) {
    if (PRODUCTS_LG[i].code === code) {
      return PRODUCTS_LG[i];
    }
  }
  return null;
}

function getProductsByCategory(category) {
  var results = [];
  for (var i = 0; i < PRODUCTS_LG.length; i++) {
    if (PRODUCTS_LG[i].categoriaId.toLowerCase() === category.toLowerCase()) {
      results.push(PRODUCTS_LG[i]);
    }
  }
  return results;
}

function getFeaturedProducts(limit) {
  limit = limit || 6;
  var featured = [];
  for (var i = 0; i < PRODUCTS_LG.length; i++) {
    if (PRODUCTS_LG[i].rating >= 4.5) {
      featured.push(PRODUCTS_LG[i]);
    }
  }
  // Ordenar por rating descendente
  featured.sort(function(a, b) { return b.rating - a.rating; });
  return featured.slice(0, limit);
}

function searchProducts(query) {
  var searchTerm = query.toLowerCase();
  var results = [];
  for (var i = 0; i < PRODUCTS_LG.length; i++) {
    var product = PRODUCTS_LG[i];
    if (product.nombre.toLowerCase().indexOf(searchTerm) !== -1 ||
        product.descripcion.toLowerCase().indexOf(searchTerm) !== -1 ||
        product.marca.toLowerCase().indexOf(searchTerm) !== -1) {
      results.push(product);
    }
  }
  return results;
}

// Función para guardar en localStorage
function saveProductsToStorage() {
  try {
    if (typeof localStorage !== 'undefined') {
      localStorage.setItem('levelup_products', JSON.stringify(PRODUCTS_LG));
      console.log('✅ Productos guardados en localStorage');
      return true;
    }
  } catch (error) {
    console.error('❌ Error guardando productos:', error);
    return false;
  }
}

// Inicializar localStorage al cargar
if (typeof window !== 'undefined' && typeof localStorage !== 'undefined') {
  saveProductsToStorage();
}

// Exportar para compatibilidad con módulos
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {
    PRODUCT_DATABASE: PRODUCT_DATABASE,
    PRODUCTS_LG: PRODUCTS_LG,
    getAllProducts: getAllProducts,
    getProductById: getProductById,
    getProductByCode: getProductByCode,
    getProductsByCategory: getProductsByCategory,
    getFeaturedProducts: getFeaturedProducts,
    searchProducts: searchProducts,
    saveProductsToStorage: saveProductsToStorage,
    loadProductsFromStorage: loadProductsFromStorage
  };
}
